{% load mptt_tags %}
{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{% static 'objectify/styles.css' %}" />
    <script src="{% static 'objectify/interact.js' %}"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
    <script src="{% static 'objectify/dom.jsPlumb-1.7.6.js' %}"></script>

    <script>
        interact('.draggable')
            .draggable({
                inertia: true,
                restrict: {
                    restriction: "parent",
                    endOnly: true,
                },
                onmove: dragMoveListener,
        });
        function dragMoveListener (event) {
        var target = event.target,
            // keep the dragged position in the data-x/data-y attributes
            x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
            y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

        // translate the element
        target.style.webkitTransform =
        target.style.transform =
          'translate(' + x + 'px, ' + y + 'px)';

        // update the position attributes
        target.setAttribute('data-x', x);
        target.setAttribute('data-y', y);
        }

        // this is used later in the resizing demo
        window.dragMoveListener = dragMoveListener;
    </script>
    <!--<script>-->
        <!--jsPlumb.ready(function() {-->
            <!--var container = document.body;-->
            <!--jsPlumb.setContainer($('#container'));-->
            <!--var primary_instance = jsPlumb.getInstance();-->
            <!--primary_instance.draggable($('.draggable'));-->
            <!--{% for wire in wires %}-->
            <!--primary_instance.connect({-->
                <!--source:"{{ wire.source }}",-->
                <!--target:"{{ wire.destination }}"-->
            <!--});-->
            <!--{% endfor %}-->
        <!--});-->
    <!--</script>-->
    <script>
        function SaveSubmit(){
            {% for node in nodes %}
            document.getElementByName('{{ node.uuid_name }}-x_val').setAttribute(
                'value',
                document.getElementById('{{ node.uuid_name }}').data-x
            )
            document.getElementByName('{{ node.uuid_name }}-y_val').setAttribute(
                'value',
                document.getElementById('{{ node.uuid_name }}').data-y
            )
            {% endfor %}
    </script>

    <title>PetriNet Editor</title>
</head>
<body>

<div id="toolbar">
    <div id="add_unit">
        <iframe src="/objectify/add" seamless="" height="300" width="400">
        </iframe>
        {% include 'objectify/save_units.html' %}
    </div>
    <input type="button" value="Add Unit" id="add_button">
</div>
<div id="container" style="height:98%;">
{% recursetree nodes %}
    <div class="draggable {{ node.level }}"
         data-x="{{ node.x_val }}"
         data-y="{{ node.y_val }}"
         id="{{ node.uuid_name }}"
         style="transform: translate({{ node.x_val }}px,{{ node.y_val }}px);">
        {% if node.shape == 'O' %}
            <div class="ellipse">
                <a>{{ node.human_readable_name }}</a>
        {% elif node.shape == 'L' %}
            <div class="rect">
                <a>{{ node.human_readable_name }}</a>
        {% endif %}
        {% if not node.is_leaf_node %}
            {{ children }}
        {% endif %}
            </div>
    </div>
{% endrecursetree %}
</div>
</body>
</html>